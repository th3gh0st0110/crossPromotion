<html>
<head>
    <style>
        .scroll {
            width: 100%;
            height: 100vh;
            position: relative;
            top: -0.06rem;
            display: block;
        }
        tbody {
            overflow-x: hidden;
            overflow-y: hidden;
            display: block;
        }
        td {
            padding-top: 0.06rem;
            padding-bottom: 0.06rem;
        }
    </style>
    <script src="jquery-3.3.1.min.js"></script>
    <script>
        function Achievement() {
            this.id =1;
            this.progress=0;
            this.isClaimed = false;
        }
        function Data() {
            this.achievements =[];
        }
        function AchievementConfig() {
            this.id=1;
            this.name="";
            this.description="";
            this.icon="";
            this.reward=0;
            this.rewardType="Soul";
            this.require =1;
            this.showProgress=true;
        }
        function Config() {
            this.items = [];

            this.GetConfigOfIndex= function (index) {
                return this.items[index];
            }
        }
        var AchievementProgress = new Data();
        var AchievementConfig = new Config();
    </script>
</head>
<body>
<table class="scroll">
    <tbody>
    </tbody>
</table>
<script>
    function CreateTable(lenght){
        var body = document.body,
            tbl  = document.getElementsByClassName("scroll")[0];
        for(var i = 0; i < lenght; i++){
            var tr = tbl.insertRow();
            var td = tr.insertCell(0);
            var rowId="row"+i;
            td.id=rowId;
        }
        body.appendChild(tbl);
        sessionStorage.setItem("currentRowIndex",0);
        for(var i = 0; i < lenght; i++){
            var rowId="#row"+i;
            $(rowId).load("./scripts/row.html",function () {
                var current =parseInt(sessionStorage.getItem("currentRowIndex"));
                var button = document.getElementsByClassName("btnImage")[current];
                button.onclick = function () {
                 ClickClaim(current);
                };
                sessionStorage.setItem("currentRowIndex",current+1);
            });
        }
    }

    function bubbleSort(array) {
        var array_size = array.length;
        for(i = 0; i < array_size; i ++) {
            for(j = 0; j < array_size; j ++) {
                if (array[i].id < array[j].id) {
                    item = array[i];
                    array[i] = array[j];
                    array[j] = item;
                }
            }
        }
        return array;
    }

    function ConvertToArray(dict) {
        var array = new Array();
        for (var key in dict) {
            array.push(dict[key]);
        }
        return bubbleSort(array);
    }
    function GetAllUrlParams(url) {
        // http://example.com/?product=shirt&color=blue&newuser&size=m
        var queryString = url ? url.split('?')[1] : window.location.search.slice(1);
        var obj = {};
        if (queryString) {
            queryString = queryString.split('#')[0];
            var arr = queryString.split('&');
            for (var i=0; i<arr.length; i++) {
                var a = arr[i].split('=');
                var paramNum = undefined;
                var paramName = a[0].replace(/\[\d*\]/, function(v) {
                    paramNum = v.slice(1,-1);
                    return '';
                });
                var paramValue = typeof(a[1])==='undefined' ? true : a[1];
                if (obj[paramName]) {
                    if (typeof obj[paramName] === 'string') {
                        obj[paramName] = [obj[paramName]];
                    }
                    if (typeof paramNum === 'undefined') {
                        obj[paramName].push(paramValue);
                    }
                    else {
                        obj[paramName][paramNum] = paramValue;
                    }
                }
                else {
                    obj[paramName] = paramValue;
                }
            }
        }

        return obj;
    }
    function GetData() {
        var url ="http://example.com/?data="+'{\n' +
            '  "achievements": [\n' +
            '  {\n' +
            '    "isClaimed": true,\n' +
            '    "progress": 10,\n' +
            '    "id": 1\n' +
            '  },\n' +
            '  {\n' +
            '    "isClaimed": false,\n' +
            '    "progress": 10,\n' +
            '    "id": 2\n' +
            '  },\n' +
            '  {\n' +
            '    "isClaimed": true,\n' +
            '    "progress": 100,\n' +
            '    "id": 3\n' +
            '  }\n' +
            ']\n' +
            '}';
        var json = GetAllUrlParams(url).data;
        return json;
    }
    jQuery.get("config/CrossPromotionConfig.txt", function (data) {
        var obj = JSON.parse(data);
        var dict = obj["items"];
        var arr = ConvertToArray(dict);
        AchievementConfig.items = arr;
        AchievementProgress=JSON.parse(GetData());
        CreateTable(arr.length);
        window.location.href="uniwebview://config?value="+data;
    })

</script>

</body>
</html>